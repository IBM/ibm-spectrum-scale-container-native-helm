# ----------------------------------------------------------------------
# Helm chart values for combined IBM Spectrum Scale CNSA/CSI Deployment
# ----------------------------------------------------------------------
# IBM Spectrum Scale CNSA 5.1.1.1 / CSI 2.2.0 release 
# ----------------------------------------------------------------------
# DISCLAIMER:
# These Helm charts are only intended to provide ease of use for an 
# initial deployment (helm install) of 
# IBM Spectrum Scale Container Native Storage Access (CNSA) 5.1.1.1 
# and IBM Spectrum Scale CSI driver version v2.2.0 for 
# Proof of Concepts (PoCs), demos or any other form of evaluations
# where no further lifecycle managment and upgrade paths are considered. 
# They are explicitly not intended and not suported for 
# any production use!
# These Helm charts are not supported by the 
# IBM Spectrum Scale container native nor CSI offerings 
# and are outside the scope of the IBM PMR process. 
# These Helm charts are provided on an "AS IS" BASIS, WITHOUT WARRANTIES 
# OR CONDITIONS OF ANY KIND, either express or implied, including, 
# without limitation, any warranties or conditions of TITLE, 
# NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. 
# You are solely responsible for determining the appropriateness of 
# using or redistributing the Work and assume any risks associated with
# Your exercise of permissions under this License.
# Note, that these Helm charts do not support any lifecycle management 
# of IBM Spectrum Scale Container Native Storage Access and 
# IBM Spectrum Scale CSI driver, especially, the 
# helm upgrade|rollback|uninstall features are not supported and are not
# expected to work. 
# You need to follow the offcial IBM documentation to perform any 
# changes or upgrades to the deployment.
# ----------------------------------------------------------------------

##########################################################
## CUSTOMER ENVIRONMENT: MINIMUM REQUIRED CONFIGURATION ##
##########################################################

## -------------------------------------------
##  IBM Spectrum Scale: Credentials & Secrets
## -------------------------------------------

# OPTIONAL: The secrets must either have been created manually prior to installation (recommended - in this case skip this section) 
#           or can be created through the Helm chart by setting createSecrets to true and providing all required credentials below.
# WARNING:  Having plain text passwords in this config file is _not_ considered best practice for security reasons and not recommended!
primarySecrets:
  # No secrets will be created through the Helm chart if createSecrets is set to false (default)!
  createSecrets: false
  cnsaGuiUser:
    # IBM Spectrum Scale CNSA user credentials on remote storage cluster GUI (cnsa-remote-gui-secret)
    remote:
      username: "cnsa_admin"
      password: "cnsa_PASSWORD"
  csiGuiUser:
    # IBM Spectrum Scale CSI driver user credentials on local compute/CNSA cluster GUI (csi-local-secret)
    local:
      username: "csi_admin1"
      password: "csi_PASSWORD1"
    # IBM Spectrum Scale CSI driver user credentials on remote storage cluster GUI (csi-remote-secret)
    remote:
      username: "csi_admin2"
      password: "csi_PASSWORD2"

## --------------------------------------------
##  IBM Spectrum Scale CNSA: License Agreement
## --------------------------------------------

# REQUIRED: User must accept the IBM Spectrum Scale license to deploy a CNSA cluster. 
# accept: By specifying true the user agrees to the terms and conditions set forth by 
#         the IBM Spectrum Scale Container Native Data Access/Data Management license located at
#         https://www14.software.ibm.com/cgi-bin/weblap/lap.pl?l=en&popup=y&li_formnum=L-CPES-C3MSKL&title=IBM%20License%20Agreement
# license: Enter either "data-access" (default) or "data-management" based on your granted license. 
#          Customers entitled to the Data Management Edition can use either "data-management" or "data-access". 
#          Customers entitled to the Data Access Edition can only use "data-access".
license:
    accept: false
    license: data-access

## --------------------------------------------------------
##  IBM Spectrum Scale CNSA: Primary Storage Configuration
## --------------------------------------------------------

# REQUIRED: The primaryFilesystem section refers to the local file system mounted from a remote storage cluster that will also host the IBM Spectrum Scale CSI driver primary fileset.
# name: Name of the file system in the local IBM Spectrum Scale CNSA cluster (Note: "_" is not allowed as part of the local file system name).
#       IMPORTANT: The local "name" must comply with DNS label name rules at https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names.
# mountPoint: Mount point of the file system in the local IBM Spectrum Scale CNSA cluster. Must start with "/mnt".
# storageFs: Device name of the file system on the remote IBM Spectrum Scale storage cluster used for the remote mount.
primaryFilesystem:
  name:           "fs1"
  mountPoint:     "/mnt/fs1"
  storageFs:      "ess_fs1"

# REQUIRED: The primaryRemoteStorageCluster section refers to the remote storage cluster that will also host the IBM Spectrum Scale CSI driver primary file system.
# host: FQDN or IP address of the GUI host for the remote IBM Spectrum Scale storage cluster.
# secretName: Name of the K8s secret that holds the IBM Spectrum Scale CNSA user credentials for this remote storage cluster.
# cacert: Name of ConfigMap containing the CA certificate of the storage cluster GUI. If not specified, the default OpenShift Container Platform CA or Red Hat CA bundle is used.
# insecureSkipVerify: To skip TLS verification, set insecureSkipVerify to true. Recommended default is false to enable TLS verification for storage cluster GUI!
# contactNodes (optional): List of contact nodes in the remote IBM Spectrum Scale storage cluster. If not specified, the operator will pick 3 nodes from the storage cluster. 
primaryRemoteStorageCluster:
  gui:
    host:               "remote-scale-gui.mydomain.com"
    secretName:         "cnsa-remote-gui-secret"
    #cacert:             "cacert-storage-cluster"
    insecureSkipVerify: true
  #contactNodes: [storageCluster1node1, storageCluster1node2, storageCluster1node3]

## -----------------------------------------------------------
##  IBM Spectrum Scale CSI: Primary File System Configuration
## -----------------------------------------------------------

# REQUIRED: primaryCluster is the local IBM Spectrum Scale CNSA cluster that will mount the primary file system and store IBM Spectrum Scale CSI driver configuration data.
primaryCluster:
  local:
    # REQUIRED: clusterId is the Cluster ID of the local IBM Spectrum Scale CNSA cluster (will be specified with helm install --set primaryCluster.local.clusterId="$CLUSTERID").
    # REQUIRED: guiHost is the Kubernetes service name of local IBM Spectrum Scale CNSA GUI service composed of "ibm-spectrum-scale-gui.<CNSA-namespace>".
    # REQUIRED: secret is name of the Kubernetes secret with username/password for the CSI driver user to access the GUI on the local IBM Spectrum Scale CNSA cluster.
    clusterId:  "needs-to-be-read-after-CNSA-deployment"   
    guiHost:    "ibm-spectrum-scale-gui.<replace-with-CNSA-namespace>"
    secret:     "csi-local-secret"
    # OPTIONAL: secureSslMode can be set to true or false. Default is false. If set to true cacert must be configured! 
    # OPTIONAL: cacert is the name of CA certificate configmap for accessing the GUI of the local IBM Spectrum Scale CNSA cluster. It is ignored if set to "".
    secureSslMode: false
    cacert:        ""
  remote:
    # REQUIRED: clusterId is the cluster ID of the remote IBM Spectrum Scale storage cluster if primaryFs is a remotely mounted file system from a remote storage cluster.
    # REQUIRED: secret is the name of the Kubernetes secret with username/password for CSI driver user to access the GUI on the remote IBM Spectrum Scale storage cluster.
    clusterId:  "215057217487177715"
    secret:     "csi-remote-secret"
    # OPTIONAL: secureSslMode can be set to true or false. Default is false. If set to true cacert must be configured! 
    # OPTIONAL: cacert is the name of CA certificate configmap for accessing the GUI of the remote IBM Spectrum Scale storage cluster. It is ignored if set to "".
    secureSslMode:   false
    cacert:          ""


##################################################
## CUSTOMER ENVIRONMENT: OPTIONAL CONFIGURATION ##
##################################################

## ------------------------------------
##  IBM Spectrum Scale CNSA: Call Home
## ------------------------------------
## https://www.ibm.com/docs/en/scalecontainernative?topic=operator-custom-resource

## By accepting Call Home you agree to allow IBM and its subsidiaries to store and use your contact information and your support information 
## anywhere they do business worldwide. For more information, please refer to the Program license agreement and documentation.
## For more information about call home, see https://www.ibm.com/docs/en/spectrum-scale/5.1.1?topic=overview-understanding-call-home.

# OPTIONAL: To enable IBM Call Home support, accept the license, remove the first "#" character on each line below and provide the required information.
# acceptLicense: If you agree, please respond with true for acceptance, else with false to decline (in this case call home will not be enabled)
# companyName: Name of the company to which the contact person belongs.
#              This name can consist of any alphanumeric characters and these non-alphanumeric characters: '-', '_', '.', ' ', ','.
# customerID: The IBM ID received by the customer upon purchasing a IBM Spectrum Scale license / or DEVLIC (developer edition) or TRYBUY (test edition).
#             This can consist of any alphanumeric characters and these non-alphanumeric characters: '-', '_', '.'.
# companyEmail: A group or task e-mail address to be contacted by IBM Support.
# countryCode: A two-letter uppercase country code in the ISO 3166-1 alpha-2 format (e.g. US for USA, DE for Germany).
# type: Marks the cluster as a "test" or a "production" system. In case this parameter is not explicitly set, "production" is used by default.
# If a proxy server should be used for uploads please provide the following information. Leave whole block commented out with "#" to not use a proxy. 
#   host: proxy server hostname or IP address
#   port: port of proxy server
#   secretName: Name of a basic-auth secret containg "username" and "password" for the proxy server. Leave commented out with "#" if no authentication for the proxy is required.
callHome:
  acceptLicense: false
#  companyName: "company"
#  customerID: "123456-kl"
#  companyEmail: "smith@email"
#  countryCode: "DE"
#  type: production | test
#  proxy:
#    host: "192.1.1.1"
#    port: "2345"
#    secretName: "proxy-secret"

## ---------------------------------------
##  IBM Spectrum Scale CNSA: Host Aliases
## ---------------------------------------
## https://www.ibm.com/docs/en/scalecontainernative?topic=operator-custom-resource

# OPTIONAL: hostAliases for environments where DNS cannot resolve the nodes of the remote IBM Spectrum Scale storage cluster. Uncomment and replicate list items to add more aliases.
hostAliases:
#  - hostname: "my-hostname1.mydomain.com"
#    ip: "10.11.12.101"

## ------------------------------------------------------
##  IBM Spectrum Scale CNSA: Node Selector Configuration
## ------------------------------------------------------
## https://www.ibm.com/docs/en/scalecontainernative?topic=operator-selectors-labels 

# REQUIRED: nodeSelector ensures to deploy IBM Spectrum Scale CNSA pods on nodes only matching the following node labels
# The Operator will check that a node has all labels defined present in order to deploy IBM Spectrum Scale CNSA pods on this node.
# The default below deploys IBM Spectrum Scale CNSA pods on all OpenShift "worker" nodes
nodeSelector:
  node-role.kubernetes.io/worker: ""

## ----------------------------------
##  IBM Spectrum Scale CNSA: Profile
## ----------------------------------
## https://www.ibm.com/docs/en/scalecontainernative?topic=operator-deployment-preparations

# Supported IBM Spectrum Scale configuration parameters set by default via the Operator. 
profile:
  pagepool:                           "1G"
  ignorePrefetchLUNCount:             "yes"
  workerThreads:                      1024
  maxFilesToCache:                    "128K"
  maxStatCache:                       "128K"
  maxblocksize:                       "16M"
  initPrefetchBuffers:                128
  prefetchTimeout:                    30
  prefetchPct:                        25
  prefetchMaxBuffersPerInstance:      1024
  controlSetxattrImmutableSELinux:    "yes"
  enforceFilesetQuotaOnRoot:          "yes"

## -----------------------------------------------------
##  IBM Spectrum Scale CSI: Node Selector Configuration
## -----------------------------------------------------
## https://www.ibm.com/docs/en/spectrum-scale-csi?topic=operator-using-node-selector

# The IBM Spectrum Scale CSI Operator will check that a node has all the labels defined below in order to deploy IBM Spectrum Scale CSI pods on this node.
# REQUIRED: csiNodeSelectorBase "scale: true" is the default node label for deploying IBM Spectrum Scale CSI pods on a node. Leave as is for the default.
csiNodeSelectorBase:
  key:    "scale"
  value:  "true"
# OPTIONAL: csiNodeSelectorProvisioner is an additional node label to run the IBM Spectrum Scale CSI Provisioner pods
# on a specifc subset of CSI nodes (highly reliable OpenShift infrastructure nodes), e.g. key: "infranode", value: "1".
# Set only if required. Otherwise set key: "" to be ignored.
csiNodeSelectorProvisioner:
  key:    ""
  value:  ""
# OPTIONAL: csiNodeSelectorAttacher is an additional node label to run the IBM Spectrum Scale CSI Attacher pods
# on a specifc subset of CSI nodes (highly reliable OpenShift infrastructure nodes), e.g. key: "infranode", value: "2".
# Set only if required. Otherwise set key: "" to be ignored.
csiNodeSelectorAttacher:
  key:    ""
  value:  ""
# OPTIONAL: csiNodeSelectorSnapshotter is an additional node label to run the IBM Spectrum Scale CSI Snapshotter pods
# on a specifc subset of CSI nodes (highly reliable OpenShift infrastructure nodes), e.g. key: "infranode", value: "3".
# Set only if required. Otherwise set key: "" to be ignored.
csiNodeSelectorSnapshotter:
  key:    ""
  value:  ""

## ---------------------------------------------------
##  IBM Spectrum Scale CSI: Tolerations Configuration
## ---------------------------------------------------
## https://www.ibm.com/docs/en/spectrum-scale-csi?topic=operator-tolerations

# OPTIONAL: csiTolerations is an array of Kubernetes tolerations distribued to IBM Spectrum Scale CSI pods.
# https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/
csiTolerations:
#  - key: "key1"
#    operator: "Equal"
#    value: "value1"
#    effect: "NoExecute"
#    tolerationSeconds: 3600
#  - key: "key2"
#    operator: "Equal"
#    value: "value1"
#    effect: "NoExecute"
#    tolerationSeconds: 3600

## --------------------------------------
##  IBM Spectrum Scale CSI: Node Mapping
## --------------------------------------
# https://www.ibm.com/docs/en/spectrum-scale-csi?topic=operator-kubernetes-spectrum-scale-node-mapping

# OPTIONAL: csiNodeMapping is an array of node mappings in case K8s node names (oc get nodes) differ from SpectrumScale node names (mmlscluster).
# In case a K8s node name starts with a number (e.g. "198.51.100.10") then use "K8sNodePrefix_< K8s Node Name >" 
# as format for the k8sNode name (e.g. "K8sNodePrefix_198.51.100.10")
csiNodeMapping:
#  - k8sNode: "< K8s Node Name >"
#    spectrumscaleNode: "< SpectrumScale Node Name >"
#  - k8sNode: "< K8s Node Name >"
#    spectrumscaleNode: "< SpectrumScale Node Name >"
#  - k8sNode: "K8sNodePrefix_< K8s Node Name >"
#    spectrumscaleNode: "< SpectrumScale Node Name >"
#  - k8sNode: "K8sNodePrefix_< K8s Node Name >"
#    spectrumscaleNode: "< SpectrumScale Node Name >"
